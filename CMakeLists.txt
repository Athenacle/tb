
CMAKE_MINIMUM_REQUIRED(VERSION 3.0)

PROJECT(taobao)
SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_SOURCE_DIR}/cmake)
SET(TB_INCLUDE_ROOT ${CMAKE_SOURCE_DIR}/include/)

INCLUDE_DIRECTORIES(${TB_INCLUDE_ROOT})

SET(CMAKE_CXX_STANDARD 14)
SET(PROJECT_VERSION 0.0.0)
STRING(TIMESTAMP TB_BUILD_TIME "%Y-%m-%d %H:%M:%SZ")
SET(USE_POSIX_THREAD 1)

SET(CMAKE_EXPORT_COMPILE_COMMANDS ON)

SET(PROJECT_BUILD_PATH ${CMAKE_SOURCE_DIR})

CONFIGURE_FILE(${TB_INCLUDE_ROOT}/config.h.in
  ${TB_INCLUDE_ROOT}/config.h)

INCLUDE(CompilerOptionCheck)
INCLUDE(ConfigCheck)

ADD_DEFINITIONS(-DHAVE_CONFIG_H)

AUX_SOURCE_DIRECTORY(${CMAKE_SOURCE_DIR}/lib TB_SOURCE_LIST)

### dependencies start

FIND_PACKAGE(Threads REQUIRED)

INCLUDE(FindZLIB)
FIND_PACKAGE(ZLIB)

INCLUDE(RapidJSON)

ADD_LIBRARY(tb STATIC ${TB_SOURCE_LIST})

##dependencies end

INCLUDE(Gtest)
AUX_SOURCE_DIRECTORY(${CMAKE_SOURCE_DIR}/test/json TB_TEST_SOURCE_LIST)
ADD_EXECUTABLE(tbTest ${TB_TEST_SOURCE_LIST}
  ${CMAKE_SOURCE_DIR}/test/main.cpp)
ADD_EXECUTABLE(log_test ${CMAKE_SOURCE_DIR}/test/utils/log_test.cpp)

INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/test)

TARGET_LINK_LIBRARIES(tbTest libgtest tb)
TARGET_LINK_LIBRARIES(log_test tb pthread)
